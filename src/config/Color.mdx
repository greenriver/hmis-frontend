import { Meta, ColorPalette, ColorItem } from '@storybook/blocks';
import theme from '@/config/theme';

<Meta title='Color' />

# Color

The swatches below reflect the default theme of the application.

<ColorPalette>{getColorItems(theme.palette)}</ColorPalette>

export function isColor(maybeColor) {
  return (
    typeof maybeColor === 'string' &&
    (maybeColor.match(/^#/) ||
      maybeColor.match(/^rgb/) ||
      maybeColor.match(/color/i))
  );
}

export function extractColors(paletteObject, prefix = '') {
  // This is based on the advanced example here: https://storybook.js.org/docs/6/writing-docs/doc-blocks/doc-block-colorpalette
  // with added complexity/recursion because of the way we've setup Alerts colors.
  return Object.entries(paletteObject).reduce((acc, [key, value]) => {
    if (isColor(value)) {
      return { ...acc, [prefix + ' ' + key]: value };
    } else if (typeof value === 'object' && value !== null) {
      // Recursively accumulate colors from nested objects
      return { ...acc, ...extractColors(value, (prefix = key)) };
    }
    return acc;
  }, {});
}

export function getColorItems(palette) {
  return Object.entries(palette).map(([k, v]) => {
    if (isColor(v)) {
      return <ColorItem key={k} title={k} colors={{ [k]: v }} subtitle='' />;
    } else if (typeof v === 'object') {
      const colors = extractColors(v);
      return <ColorItem key={k} title={k} colors={colors} subtitle='' />;
    }
    return null;
  });
}
